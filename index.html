<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>DfE R-Shiny Standards • dfeshiny</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="DfE R-Shiny Standards">
<meta name="description" content="R package containing preferred methods for creating official DfE R-Shiny dashboards.">
<meta property="og:description" content="R package containing preferred methods for creating official DfE R-Shiny dashboards.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">dfeshiny</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9">
<p><a href="http://dfe-analytical-services.github.io/dfeshiny/" class="external-link"><img src="reference/figures/dfeshiny.png" align="right" width="120"></a></p>
<div class="section level1">
<div class="page-header"><h1 id="dfeshiny">dfeshiny<a class="anchor" aria-label="anchor" href="#dfeshiny"></a>
</h1></div>
<p>An R package to support analysts in developing official DfE dashboards and help them meet the necessary standards required of public facing government services.</p>
<div class="section level2">
<h2 id="installing-the-package">Installing the package<a class="anchor" aria-label="anchor" href="#installing-the-package"></a>
</h2>
<p>To install, run <code>renv::install("dfe-analytical-services/dfeshiny")</code>.</p>
<div class="section level3">
<h3 id="potential-errors-when-installing">Potential errors when installing<a class="anchor" aria-label="anchor" href="#potential-errors-when-installing"></a>
</h3>
<p>If you get <code>ERROR [curl: (22) The requested URL returned error: 401]</code>, and don’t know why, try running <code>Sys.unsetenv("GITHUB_PAT")</code> to temporarily clear your GitHub PAT variable.</p>
<p>Then try to install again.</p>
<p>If this works, then you will need to look for where that “GITHUB_PAT” variable is being set from and remove it to permanently fix the issue, contact us for support if you need help with this or have any other issues installing.</p>
</div>
</div>
<div class="section level2">
<h2 id="using-this-package-in-a-dfe-data-dashboard">Using this package in a DfE data dashboard<a class="anchor" aria-label="anchor" href="#using-this-package-in-a-dfe-data-dashboard"></a>
</h2>
<div class="section level3">
<h3 id="adding-cookies-to-your-dashboard">Adding cookies to your dashboard<a class="anchor" aria-label="anchor" href="#adding-cookies-to-your-dashboard"></a>
</h3>
<p>dfeshiny provides the facility to add a gov.uk styled cookie banner to your site, which is fully functional in terms of controlling the user permissions for tracking their use of the site via Google Analytics.</p>
<p>Before adding the cookie consent banner, you will need to obtain a Google Analytics key that’s both unique to your app and stored within the DfE Google Analytics domain. You can request a key from the <a href="mailto:statistics.development@education.gov.uk">Statistics Development team</a>. This should then be added as a variable to your dashboard’s <a href="https://github.com/dfe-analytical-services/dfeshiny/blob/cookie-module/tests/test_dashboard/global.R" class="external-link">global.R</a> file (replacing <code>ABCDE12345</code> below with the key provided by the Statistics Development team):</p>
<pre><code><span><span class="va">google_analytics_key</span> <span class="op">&lt;-</span> <span class="st">'ABCDE12345'</span></span></code></pre>
<p>Next, you should copy the javascript file (<a href="https://raw.githubusercontent.com/dfe-analytical-services/dfeshiny/cookie-module/js/cookie-consent.js" class="external-link">cookie_consent.js</a>) necessary for controlling the cookie storage in the user’s browser to the <code>www/</code> folder in your dashboards repository.</p>
<p>Once you’ve made the above updates, add the following lines to your <a href="https://github.com/dfe-analytical-services/dfeshiny/blob/cookie-module/tests/test_dashboard/ui.R" class="external-link">ui.R</a> script (updating “My DfE R Shiny data dashboard” with the name of your app):</p>
<pre><code>dfe_cookie_script(),
cookie_banner_ui("cookies", name = "My DfE R Shiny data dashboard"),</code></pre>
<p>Putting these on the lines <em>just before</em> the <code>shinyGovstyle::header(...)</code> line should work well.</p>
<p>Then add the following code to your <a href="https://github.com/dfe-analytical-services/dfeshiny/blob/cookie-module/tests/test_dashboard/server.R" class="external-link">server.R</a> script somewhere <em>inside</em> the <code>server &lt;- function(input, output, session) {...}</code> function (you shouldn’t need to change anything in this one):</p>
<pre><code><span><span class="va">output</span><span class="op">$</span><span class="va">cookie_status</span> <span class="op">&lt;-</span> <span class="fu">dfeshiny</span><span class="fu">::</span><span class="fu"><a href="reference/cookie_banner_server.html">cookie_banner_server</a></span><span class="op">(</span></span>
<span>  <span class="st">"cookies"</span>,</span>
<span>  input_cookies <span class="op">=</span> <span class="fu">reactive</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">cookies</span><span class="op">)</span>,</span>
<span>  input_clear <span class="op">=</span> <span class="fu">reactive</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">cookie_consent_clear</span><span class="op">)</span>,</span>
<span>  parent_session <span class="op">=</span> <span class="va">session</span>,</span>
<span>  google_analytics_key <span class="op">=</span> <span class="va">google_analytics_key</span></span>
<span><span class="op">)</span></span></code></pre>
<p>Finally, you should make sure you’re using the <code><a href="reference/support_panel.html">dfeshiny::support_panel()</a></code> function within the <code>navListPanel(...)</code> in your <a href="https://github.com/dfe-analytical-services/dfeshiny/blob/cookie-module/tests/test_dashboard/ui.R" class="external-link">ui.R</a> script as this will provide users with the necessary explanatory text on how we use cookies and the ability to change their decision on whether or not to accept the use of cookies.</p>
</div>
<div class="section level3">
<h3 id="adding-a-custom-disconect-message-to-your-dashboard">Adding a custom disconect message to your dashboard<a class="anchor" aria-label="anchor" href="#adding-a-custom-disconect-message-to-your-dashboard"></a>
</h3>
<p>dfeshiny provides a function to add a custom disconnect message to your dashboard - this will appear when a dashboard would otherwise ‘grey-screen’ and will include options to refresh the page, go to overflow sites or visit the publication directly on Explore education statistics.</p>
<p>The following parameters should be defined and up-to-date in the global.R script:</p>
<ul>
<li>sites_list</li>
<li>ees_pub_name</li>
<li>ees_publication</li>
</ul>
<p>To include a custom disconnect message, you should insert the following line into the ui.R script:</p>
<pre><code>custom_disconnect_message(
   links = sites_list,
   publication_name = ees_pub_name,
   publication_link = ees_publication
 ),</code></pre>
<p>Putting this on the lines <em>just before</em> the <code>shinyGovstyle::header(...)</code> line should work well.</p>
</div>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>Try and make use of the <a href="https://usethis.r-lib.org/" class="external-link">usethis</a> package wherever possible.</p>
<p>When you initially clone the package, the first thing you’ll need to do is install <a href="https://devtools.r-lib.org/" class="external-link">devtools</a>:</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span></code></pre>
<p>Then to load in the package in its current form:</p>
<pre><code><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span></span></code></pre>
<div class="section level3">
<h3 id="adding-a-packagedependency">Adding a package/dependency<a class="anchor" aria-label="anchor" href="#adding-a-packagedependency"></a>
</h3>
<p><code>usethis::use_package(&lt;package_name&gt;)</code></p>
<p>This will create a new script within the package R/ folder.</p>
<p>Note that when adding a function from another package into one of the dfeshiny functions you will need to explicitly state the package in the function call, e.g.:</p>
<p><code>package::function()</code></p>
<p>Alternatively, if there’s a lot of uses of a single function within one of our R scripts, you can call that function once at the top of the R script, e.g:</p>
<pre><code>@' importFrom package function</code></pre>
<p>For more information see the <a href="https://roxygen2.r-lib.org/articles/namespace.html" class="external-link">roxygen2 documentation on declaring dependencies</a>.</p>
</div>
<div class="section level3">
<h3 id="creating-a-new-function-script">Creating a new function script<a class="anchor" aria-label="anchor" href="#creating-a-new-function-script"></a>
</h3>
<p><code>usethis::use_r(name = &lt;script_name&gt;)</code></p>
<p>This will create a new script within the package R/ folder.</p>
</div>
<div class="section level3">
<h3 id="creating-a-new-function-test-script">Creating a new function test script<a class="anchor" aria-label="anchor" href="#creating-a-new-function-test-script"></a>
</h3>
<p><code>usethis::use_test(name = &lt;script_name&gt;)</code></p>
<p>This will create a new test script within the package testthat/ folder.</p>
</div>
<div class="section level3">
<h3 id="updating-the-package-version">Updating the package version<a class="anchor" aria-label="anchor" href="#updating-the-package-version"></a>
</h3>
<p>Once changes have been completed, reviewed and are ready for use in the wild, you can increment the package version using:</p>
<p><code>usethis::use_version()</code></p>
<p>Once you’ve incremented the version number, it’ll add a new heading to news.md.</p>
<p>Add a summary under news.md and then accept it’s offer to commit on your behalf.</p>
<p>Once pushed and on the main branch, create a new release in GitHub itself.</p>
</div>
<div class="section level3">
<h3 id="running-tests">Running tests<a class="anchor" aria-label="anchor" href="#running-tests"></a>
</h3>
<p>You should run the following lines to test the package locally:</p>
<pre><code><span><span class="co"># To check functionality</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span> <span class="co"># Ctrl-Shft-E</span></span>
<span><span class="fu">shinytest2</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/shinytest2/reference/test_app.html" class="external-link">test_app</a></span><span class="op">(</span><span class="st">"tests/test_dashboard"</span><span class="op">)</span> <span class="co"># important as not currently ran in CI checks, need to move this over</span></span>
<span></span>
<span><span class="co"># For code styling</span></span>
<span><span class="fu">styler</span><span class="fu">::</span><span class="fu"><a href="https://styler.r-lib.org/reference/style_pkg.html" class="external-link">style_pkg</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># currently has a known error on cookies.R</span></span>
<span><span class="fu">lintr</span><span class="fu">::</span><span class="fu">lint_package</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing dfeshiny</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Rich Bielby <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-9070-9969" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Charlotte Foster <br><small class="roles"> Author </small>  </li>
<li>Cam Race <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/dfe-analytical-services/dfeshiny/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/dfe-analytical-services/dfeshiny/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/dfe-analytical-services/dfeshiny?branch=main" class="external-link"><img src="https://codecov.io/gh/dfe-analytical-services/dfeshiny/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich Bielby, Charlotte Foster, Cam Race.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
