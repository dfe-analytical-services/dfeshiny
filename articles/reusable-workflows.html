<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Reusable workflows • dfeshiny</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Reusable workflows">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dfeshiny</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.3.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/implementing-cookies.html">Implementing cookies consent</a></li>
    <li><a class="dropdown-item" href="../articles/reusable-workflows.html">Reusable workflows</a></li>
    <li><a class="dropdown-item" href="../articles/using-the-dfeshiny-deploy-template.html">Using the dfeshiny Deploy Template</a></li>
    <li><a class="dropdown-item" href="../articles/what-to-avoid.html">What to avoid</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Reusable workflows</h1>
            
      

      <div class="d-none name"><code>reusable-workflows.Rmd</code></div>
    </div>

    
    
<p>We provide several reusable GitHub Actions workflows in dfeshiny
(where workflows are automated actions that can be triggered by events
such as pull requests in GitHub). These are primarily intended for use
with dashboards, but can also be used with other projects hosted on
GitHub.</p>
<p>The reusable workflows covered in this article are:</p>
<ul>
<li>Automated tests</li>
<li>Lintr</li>
<li>Pull request Trello card creation</li>
</ul>
<p>The dashboard deploy reusable workflow is covered separately in the
<a href="using-the-dfeshiny-deploy-template.html">using the dfeshiny
deploy template article</a>.</p>
<p>To implement automated workflows, your repository will require the
folder <strong>.github/workflows/</strong>. You’ll more than likely have
this folder, but if not you’ll need to create it.</p>
<div class="section level2">
<h2 id="automated-tests">Automated tests<a class="anchor" aria-label="anchor" href="#automated-tests"></a>
</h2>
<p>The automated-tests reusable workflow triggers GitHub Actions to run
<code><a href="https://rstudio.github.io/shinytest2/reference/test_app.html" class="external-link">shinytest2::test_app()</a></code> on your repository code. To enable
this, simply copy the following code into a .yaml file in the
.github/workflows/ folder of your repository.</p>
<pre><code>on:
  push:
    branches:
      - main
  pull_request:

name: Test dashboard

jobs:
  automatedTests:
    uses: dfe-analytical-services/dfeshiny/.github/workflows/automated_tests_template.yaml@main</code></pre>
<p>And then add &gt; commit &gt; push to your remote GitHub
repository.</p>
<p>Once implemented, this will run <code>shinytest2</code> whenever a
change is made to a pull request or your main branch on GitHub. The
results can be found in the checks section of your pull request and
Actions tab of your repository.</p>
<p>Clicking into a given test result will show the steps taken to run
the automated tests and under the <strong>Run tests</strong> stage, you
can find the results of the tests as shown below.</p>
<div class="float">
<img src="images/GA-automated-tests-results.png" alt="Image of the results of example automated tests viewed in GitHub Actions"><div class="figcaption">Image of the results of example automated tests
viewed in GitHub Actions</div>
</div>
</div>
<div class="section level2">
<h2 id="lintr">Lintr<a class="anchor" aria-label="anchor" href="#lintr"></a>
</h2>
<p>The lintr reusable workflow triggers GitHub Actions to run
<code>lintr::lint_dir()</code> on your repository code. This will not
change any of your code, but will produce recommendations of
improvements to code layout and styling. To enable this, simply copy <a href="https://github.com/dfe-analytical-services/dfeshiny/blob/main/.github/workflows/lintr.yml" class="external-link">.github/workflows/lintr.yml</a>
to the .github/workflows/ folder of your repository, change the
is_package parameter from true to false, and then add &gt; commit &gt;
push to your remote GitHub repository.</p>
<p>Once set up, lintr will run on your code anytime you create or update
a pull request and when anything gets merged into main. Results will be
added as comments to the relevant pull request where relavent and also
available through the GitHub actions tab in the same way as the
shinytest2 results above.</p>
</div>
<div class="section level2">
<h2 id="pull-request-trello-card-creation">Pull request Trello card creation<a class="anchor" aria-label="anchor" href="#pull-request-trello-card-creation"></a>
</h2>
<div class="section level3">
<h3 id="using-the-trello-api-key-and-token">Using the Trello API key and token<a class="anchor" aria-label="anchor" href="#using-the-trello-api-key-and-token"></a>
</h3>
<p>This workflow requires authorisation to access the required Trello
board. This can be done at the GitHub organisation level, so requires a
dfe-analytical-services admin to set up. This is done in the GitHub
project (e.g. dfe-analytical-services) at Settings &gt; Secrets and
variables &gt; Actions.</p>
<p>If you are setting up this workflow to create a ticket on the
Statistics Development team’s board, then the Trello API key and token
should already be stored under Organization secrets. To give a given
repository access to these secrets:</p>
<ul>
<li>click the edit symbol alongside each of “TRELLO_API_KEY” and
“TRELLO_API_TOKEN”
<ul>
<li>note that if you don’t see the edit symbols in the table alongside
the above entries, you may need to click the “Manage organisation
secrets button” if present</li>
</ul>
</li>
<li>click the settings cog next to the selected repositories
dropdown</li>
<li>find and tick the required repository</li>
<li>click save changes</li>
<li>make sure you’ve done this for both “TRELLO_API_KEY” and
“TRELLO_API_TOKEN”</li>
</ul>
<p>If you need to link to a different board or update the API key and
token variables for the Statistics Development board, then refer to the
<a href="#create-a-new-trello-api-key">create a new Trello API key
section</a> below.</p>
</div>
<div class="section level3">
<h3 id="creating-the-workflow">Creating the workflow<a class="anchor" aria-label="anchor" href="#creating-the-workflow"></a>
</h3>
<p>To implement the workflow, you can copy <a href="https://github.com/dfe-analytical-services/dfeshiny/blob/main/.github/workflows/trello.yaml" class="external-link">.github/workflows/trello.yaml</a>
into your own repository’s .github/workflows folder.</p>
<div class="section level4">
<h4 id="title-format">title-format<a class="anchor" aria-label="anchor" href="#title-format"></a>
</h4>
<p>Update the <code>title-format</code> to reflect the name of your own
repository.</p>
</div>
<div class="section level4">
<h4 id="api-key-and-api-token">api-key and api-token<a class="anchor" aria-label="anchor" href="#api-key-and-api-token"></a>
</h4>
<p>If the target board is the Statistics development team board, then
leave the <code>api-key</code> and <code>api-token</code> variables as
is. If directing cards to a different board, then you’ll likely need
to<br><a href="#create-a-new-trello-api-key">create a new Trello API key</a>
and update TRELLO_API_KEY and TRELLO_API_TOKEN to the corresponding
organisation secrets for the new board.</p>
</div>
<div class="section level4">
<h4 id="list-id-and-label-ids">list-id and label-ids<a class="anchor" aria-label="anchor" href="#list-id-and-label-ids"></a>
</h4>
<p>The list-id and label-ids parameters can then be updated as needed.
For the statistics development team board the relevant codes are:</p>
<ul>
<li>
<code>list-id</code>:
<ul>
<li>In review: 63ce5064a4859b0387f46b9b</li>
</ul>
</li>
<li>
<code>label-ids</code>:
<ul>
<li>New stuff (6): 63ce4ffcbfa825468a8e2a69</li>
<li>dfeshiny (9): 67b33b30b7f808294a05b1ab</li>
</ul>
</li>
</ul>
<p>To identify IDs for other items or on a different board, select a
card on your Trello board and then add “.json” to the URL in the browser
address box. This shows the card info in json format from which you can
extract the required IDs after a bit of detective work.</p>
</div>
</div>
<div class="section level3">
<h3 id="create-a-new-trello-api-key">Create a new Trello API key<a class="anchor" aria-label="anchor" href="#create-a-new-trello-api-key"></a>
</h3>
<p>To link to a new board or replace the key and token for access to the
Statistics Development team board, you’ll first need to create a Trello
Power-Up:</p>
<ul>
<li>Navigate to the <a href="https://trello.com/power-ups/admin" class="external-link">Trello
power ups admin page</a>
</li>
<li>Click New</li>
<li>Give the power up a name and provide your e-mail and name, click
create</li>
<li>Navigate to the API key page</li>
<li>Copy the API key</li>
<li>Back on GitHub, navigate to Organisation settings &gt; Secrets and
variables &gt; Actions
<ul>
<li>If linking to a new board, click New organisation secret and paste
the API key into the Value field. Choose a name for the key
e.g. MY_TEAM_TRELLO_API_KEY</li>
<li>If refreshing the Statistics development team key, click the edit
icon for TRELLO_API_KEY, click enter a new value and paste the API
key</li>
</ul>
</li>
<li>Back on your Trello Power up, click manually generate a
<strong>token</strong> (ignore the Secret, this is not needed).
<ul>
<li>Click Allow and then copy the API token that’s generated</li>
</ul>
</li>
<li>And back to GitHub orgnasation secrets once more…
<ul>
<li>If linking to a new board, click New organisation secret and paste
the API token into the Value field. Choose a name for the key
e.g. MY_TEAM_TRELLO_API_TOKEN</li>
<li>If refreshing the Statistics development team key, click the edit
icon for TRELLO_API_TOKEN, click enter a new value and paste the API
token</li>
</ul>
</li>
</ul>
<p>As noted, the API secret is not needed. If you use this in place of
the token, you’ll get a 401 error when the workflow tries to run.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich Bielby, Charlotte Foster, Cam Race.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
